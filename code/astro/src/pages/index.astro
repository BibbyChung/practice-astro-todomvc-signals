---
import Main from "~/layouts/main.astro";
import HelloWorldSvelte from "~/lib/components/hello-world.svelte";
---

<Main title="home">
  <HelloWorldSvelte />

  <button class="btn mt-2">get user</button>
</Main>

<style></style>

<script>
  import { trpc } from "~/lib/common/trpc";
  import { fromEvent, switchMap, tap, from } from "rxjs";

  const getUserSub = fromEvent(document.querySelector(".btn")!, "click")
    .pipe(
      tap(async (ev) => {
        console.log(ev);
        const id = "8888888";
        await trpc.user.createUser.mutate({
          id,
          name: "bbbb",
        });

        const pAll = await Promise.allSettled([
          trpc.user.getUserById.query(id),
          trpc.user.getUserById.query(id),
          trpc.user.getUserById.query(id),
          trpc.user.getUserById.query(id),
          trpc.user.getUserById.query(id),
          trpc.user.getUserById.query(id),
          trpc.user.getUserById.query(id),
        ]);

        console.log(pAll);
      })
    )
    .subscribe();

  const getTodos = fromEvent(document.querySelector(".btn")!, "click")
    .pipe(
      switchMap(() => from(trpc.todos.getAll.query())),
      tap((data) => console.log(data))
    )
    .subscribe();
</script>

<!-- title="Welcome to Astro." -->
